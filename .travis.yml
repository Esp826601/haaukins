sudo: required
dist: trusty

language: go
go:
- '1.13'

services:
- docker

cache:
  directories:
  - "$HOME/.cache/go-build"

env:
  global:
    GIT_TAG=$(git describe --tags)

before_install:
- openssl aes-256-cbc -K $encrypted_a30037d67e8c_key -iv $encrypted_a30037d67e8c_iv -in travis_deploy_key.enc -out ./travis_deploy_key -d

script: go test -v -race ./...

before_deploy:
- go run ./scripts/deploy/build_binaries.go

deploy:
- provider: releases
  api_key:
    secure: l9mshPUNR0SJTKsUSZdQpnQQxGE9LuZhF61u7Xw75Gc95pfJOJc+OZ6dKsrR3PIwTlvIjZQVWRvA8hw4nIdIUTSVii3gtxtkFz8dtfAS1uk68tVlFW5uYhLYZ0gmGZTXo76nYUzoIS9sY0pTTdop36q5PZquO6G53FHZXGqJIikjwjbOLV2RjlHPKrFa7V6ttocmkFDo+KcRrgVE5QQiFd8T0vUc/F8J/8K4wOaJjzWHj7yjhYqMS3ItRT946PVG0g7P3CpXkRExw1Lcam7PSUJNoYSG7mZTIBcWxBW51Xz09iVxG8+yY8dFej/cKexdvSR9nw28w0OGqmrLa6JhZbUjAaOdxp2xPsbbDhC03wnNllA4UBBQMNj3rC+F9/aWBl01cvjWJYh/3b2GBHf9ZFFaBfH91jRfwVL69/L7mUAFeyDCSSw9qIm4TffQ9xtsPArNg5nRKPeKWuE8LmnID7MCtoq4GP/Tu8J+MZhhGuc8RBVdqNblNBWUJglzOUqv7rwupncuxrx+ehpAoMbPx5jxDITckmAxSvwfOS5dXQQaG6Ko/NUWiTHzTLF1dgvn4/thTZ40XDTtaFP1bya7z5/jv5sAEY7Ux0yCjU1InJwurXBPx7h8HLqxXFhxX38zSxjrAOetHk3mvBIZOUJtSVD9gsiaA/T7qofLIETgH5A=
  file_glob: true
  file: "./build/*"
  skip_cleanup: true
  on:
    tags: true
- provider: script
  script: "bash ./scripts/deploy/deploy.sh"
  skip_cleanup: true
  on:
    tags: true

notifications:
  slack:
    secure: pbJLqnA2ilvWp9REuHrWqf/Pl/hSGkENBvjBPQyW6TvJytUHiObwP/aCQxyL31i8ZzItc1r+9db1tk12BFE5eObxyb4DHmHbaQ1/pwA7Bzf2SsM5J68Pyr9w/kXk44PUqfifeBLH/xhjCNtm+f8ZIkJiKfOZxgn9ddYt/vG4Nt8w6s43ZODDO+Caql1AH1iZ4xsJ6X/VPyvWfh9FaZpYnDQBI10fcsg4kGMZ6+p4pZ2wvRyo8LQJoIUcDGXATr7+kr3wB04r3BRAACydg0bDWPpuRBn6svIar6J12lHR05n0K+rtl+VYLLGJZuNPn3Tqh7tdt0ifrPTE0W1fM24mlOikLlYWhZ5Olf23DVxbxqeegu/x4E4ctT9ua/0UbBfZHVlb9pzFf+OoSYwX/N7dE9Dt7zuoeMebL3ECYXxyEvP1qHLNvxmeVydFFHKy2pu1pSQP/paz+1ShqgjbMOHFrz52HVvy/7b1qCMKDFnpYp6lc9adPgWJpsxGAY2dMw83iBJno+A9LF3LJzhv2TdRC+w1fQTUBdzW/wUkDLa9diHNdolN/2gFsAK8iJtLc2cz6hAh/2U4mRdrBjCULqZcGwBRS5jPA79zDZpMwhbET2j3vrqUx6iicAI8MI6Nptkt3g193trwS7oljXOkpdqBkXdh/ZpRYoiK/3nOc/LKfnI=
